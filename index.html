<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Academia de Arte MC ‚Äî Maxi Cortez</title>
  <meta name="description" content="Academia de Arte MC ‚Äî Inscripci√≥n, galer√≠a, alumnos destacados y Mundo Lapicini." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#032f2b;
      --bg2:#0a6b63;
      --stroke: rgba(255,255,255,.18);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent:#32e3c0;
      --accent2:#00bcd4;
      --danger:#ff5d5d;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(50,227,192,.35), transparent 55%),
        radial-gradient(900px 450px at 85% 20%, rgba(0,188,212,.25), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    .wrap{ width:min(1120px, 92vw); margin:18px auto 40px; position:relative; }
    @media (max-width:520px){ .wrap{ width:94vw; margin-top:14px; } }

    .deco{ position:absolute; inset:0; pointer-events:none; z-index:0; }
    .deco img{ position:absolute; opacity:.18; filter: drop-shadow(0 20px 40px rgba(0,0,0,.5)); }
    .deco .logo{ width:170px; left:-30px; top:-20px; }
    .deco .lapicini{ width:240px; right:-40px; bottom:-40px; opacity:.22; }
    @media (max-width:520px){
      .deco .logo{ width:118px; left:-18px; top:-10px; opacity:.14;}
      .deco .lapicini{ width:168px; right:-22px; bottom:-22px; opacity:.16;}
    }

    header{
      position:relative; z-index:1;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:16px 14px;
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }
    .brand{ display:flex; gap:12px; align-items:center; min-width:0; }
    .brand-badge{
      width:44px;height:44px;border-radius:14px;
      border:1px solid var(--stroke);
      background: radial-gradient(circle at 30% 25%, rgba(50,227,192,.6), rgba(255,255,255,.08));
      display:grid;place-items:center;
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
      flex:0 0 auto;
    }
    .brand-badge span{ font-weight:800; letter-spacing:.5px; }
    .brand h1{
      margin:0;
      font-size: clamp(16px, 2.2vw, 22px);
      line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .header-actions{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--txt); font-size:12px;
      cursor:pointer; text-decoration:none; user-select:none;
      transition:.2s;
    }
    .pill:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }
    .pill.primary{
      background: linear-gradient(135deg, rgba(50,227,192,.90), rgba(0,188,212,.75));
      border:0; color:#052a26; font-weight:700;
    }

    main{
      position:relative; z-index:1;
      margin-top:14px;
      display:grid;
      grid-template-columns: 290px 1fr;
      gap:14px;
    }
    @media (max-width:900px){ main{ grid-template-columns: 1fr; } }

    .sidebar{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.07);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .tabs{ display:flex; flex-direction:column; }
    .tab-btn{
      border:0; background: transparent; color:var(--txt);
      padding:14px 14px;
      display:flex; justify-content:space-between; align-items:center;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,.08);
      transition:.15s;
      font-size:14px;
      text-align:left;
    }
    .tab-btn:hover{ background: rgba(255,255,255,.06); }
    .tab-btn.active{
      background: linear-gradient(90deg, rgba(50,227,192,.25), rgba(0,188,212,.12));
    }
    .tab-btn small{ color:var(--muted); font-size:11px; }

    .content{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .section{ display:none; padding:16px; }
    .section.active{ display:block; }

    .title{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .title h2{ margin:0; font-size:18px; }
    .title p{ margin:6px 0 0; color:var(--muted); font-size:13px; }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:700px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:14px;
    }

    label{ display:block; margin:10px 0 6px; font-size:12px; color:var(--muted); }
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color:var(--txt);
      outline:none;
      font-size:14px;
    }
    textarea{ min-height:90px; resize:vertical; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .btn{
      border:0; border-radius:14px;
      padding:12px 14px;
      cursor:pointer; font-weight:700;
      transition:.18s;
      display:inline-flex; gap:8px;
      align-items:center; justify-content:center;
      text-decoration:none; user-select:none;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(50,227,192,.95), rgba(0,188,212,.75));
      color:#052a26;
    }
    .btn.ghost{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
      color:var(--txt);
    }
    .btn.danger{
      background: rgba(255,93,93,.18);
      border:1px solid rgba(255,93,93,.35);
      color:#ffd1d1;
    }
    .btn:hover{ transform: translateY(-1px); }

    .hint{ font-size:12px; color:var(--muted); margin:10px 0 0; }
    .hr{ height:1px; background: rgba(255,255,255,.10); margin:14px 0; }

    .badge{
      display:inline-flex; gap:6px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-size:12px; color:var(--txt);
      white-space:nowrap;
    }

    .gallery{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
    @media (max-width:1000px){ .gallery{ grid-template-columns: repeat(3, 1fr);} }
    @media (max-width:700px){ .gallery{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:430px){ .gallery{ grid-template-columns: 1fr;} }

    .thumb{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      overflow:hidden;
      position:relative;
    }
    .thumb img{ width:100%; height:170px; object-fit:cover; display:block; }
    .thumb .cap{ padding:10px; font-size:12px; color:var(--muted); }
    .thumb .tag{
      position:absolute; top:10px; left:10px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      padding:6px 10px; border-radius:999px;
      font-size:11px;
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
    }
    th, td{
      text-align:left;
      padding:10px;
      font-size:13px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:top;
    }
    th{ color:rgba(255,255,255,.80); font-weight:700; background: rgba(0,0,0,.12); }
    td{ color:rgba(255,255,255,.90); }
    .small{ font-size:12px; color:var(--muted); }

    .video{
      aspect-ratio: 16 / 9;
      width:100%;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      overflow:hidden;
      background: rgba(0,0,0,.2);
    }
    .video iframe{ width:100%; height:100%; border:0; }

    footer{ margin-top:14px; padding:12px 16px; color:rgba(255,255,255,.65); font-size:12px; text-align:center; }

    /* ===== LOGIN GATE ===== */
    .gate{
      position:fixed; inset:0; z-index:9999;
      display:none; align-items:center; justify-content:center;
      padding:16px;
      background:
        radial-gradient(900px 450px at 20% 10%, rgba(50,227,192,.25), transparent 60%),
        radial-gradient(700px 400px at 80% 25%, rgba(0,188,212,.20), transparent 60%),
        rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    .gate.show{ display:flex; }
    .gate-box{
      width:min(980px, 96vw);
      border:1px solid rgba(255,255,255,.20);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    }
    .gate-head{
      padding:16px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .gate-title{ display:flex; gap:10px; align-items:center; min-width:0; }
    .gate-title h2{
      margin:0; font-size:16px; line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .gate-title p{ margin:2px 0 0; color:var(--muted); font-size:12px; }
    .gate-body{
      padding:14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    @media (max-width:860px){ .gate-body{ grid-template-columns: 1fr; } }
    .gate-hero{
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:14px;
      background: rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
    }
    .gate-hero img{
      width:110px;
      opacity:.18;
      position:absolute;
      right:-10px;
      bottom:-10px;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.5));
    }
    .chip{
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius:999px;
      font-size:12px;
      color:rgba(255,255,255,.82);
    }
    .pw{ position:relative; }
    .pw input{ padding-right:44px; }
    .eye{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color:rgba(255,255,255,.9);
      width:34px;
      height:34px;
      border-radius:12px;
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
    }
  </style>
</head>

<body>
  <!-- LOGIN / REGISTER GATE -->
  <div class="gate" id="gate">
    <div class="gate-box">
      <div class="gate-head">
        <div class="gate-title">
          <div class="brand-badge" aria-hidden="true"><span>MC</span></div>
          <div style="min-width:0">
            <h2>Acceso a Academia de Arte MC & Mundo Lapicini</h2>
            <p>Registrate o ingres√° para continuar ‚Ä¢ Prof. Maxi Cortez</p>
          </div>
        </div>
        <span class="badge">maurocortez17@gmail.com</span>
      </div>

      <div class="gate-body">
        <div class="gate-hero">
          <h3 style="margin:0 0 6px">¬øQu√© vas a encontrar adentro?</h3>
          <p class="small" style="margin:0 0 10px">
            Inscripci√≥n por sedes y turnos, galer√≠a, <b>alumnos destacados</b> y el <b>Mundo Lapicini</b>.
            El <b>Cap√≠tulo 1</b> se desbloquea con acceso habilitado (pago confirmado).
          </p>
          <div class="row" style="gap:8px">
            <span class="chip">R√≠o Cuarto</span>
            <span class="chip">Las Vertientes</span>
            <span class="chip">Alcira Gigena</span>
            <span class="chip">Destacados 2025</span>
            <span class="chip">Cap√≠tulo 1 bloqueado</span>
          </div>
          <img src="lapicini.png" alt="Lapicini"/>
          <div class="hr"></div>
          <a class="btn ghost" href="mailto:maurocortez17@gmail.com">Contactar por email</a>
        </div>

        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ingresar</h3>
            <button class="btn ghost" id="btnSwitchGate" type="button">Crear cuenta</button>
          </div>

          <div id="loginBox">
            <label>Email</label>
            <input id="loginEmail" type="email" placeholder="tuemail@gmail.com"/>

            <label>Contrase√±a</label>
            <div class="pw">
              <input id="loginPass" type="password" placeholder="tu contrase√±a"/>
              <div class="eye" data-eye="loginPass" title="Mostrar/Ocultar">üëÅÔ∏è</div>
            </div>

            <div class="row" style="margin-top:12px">
              <button class="btn primary" id="btnLogin" type="button">Ingresar</button>
            </div>
            <p class="hint">Si sos alumno nuevo, toc√° ‚ÄúCrear cuenta‚Äù.</p>
          </div>

          <div id="registerBox" style="display:none">
            <label>Nombre completo</label>
            <input id="regNombre" placeholder="Ej: Juan P√©rez"/>

            <label>Email</label>
            <input id="regEmail" type="email" placeholder="Ej: alumno@gmail.com"/>

            <label>Contrase√±a</label>
            <div class="pw">
              <input id="regPass" type="password" placeholder="Eleg√≠ una contrase√±a"/>
              <div class="eye" data-eye="regPass" title="Mostrar/Ocultar">üëÅÔ∏è</div>
            </div>

            <div class="row" style="margin-top:12px">
              <button class="btn primary" id="btnRegister" type="button">Crear cuenta</button>
              <button class="btn ghost" id="btnBackLogin" type="button">Volver</button>
            </div>
            <p class="hint">Al crear la cuenta, entr√°s a la plataforma. El Cap√≠tulo 1 se habilita luego del pago.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="deco">
      <img class="logo" src="logo.png" alt="Logo Academia de Arte MC">
      <img class="lapicini" src="lapicini.png" alt="Lapicini">
    </div>

    <header>
      <div class="brand">
        <div class="brand-badge" aria-hidden="true"><span>MC</span></div>
        <div style="min-width:0">
          <h1>Academia de Arte MC ‚Äî Maxi Cortez</h1>
          <p id="userLine">Profesional ‚Ä¢ Para todas las edades ‚Ä¢ Sin conocimientos previos</p>
        </div>
      </div>

      <div class="header-actions">
        <a class="pill primary" id="btnWhatsappHeader" href="#" target="_blank" rel="noopener">WhatsApp</a>
        <a class="pill" href="mailto:maurocortez17@gmail.com">maurocortez17@gmail.com</a>
        <button class="pill" id="btnLogout" type="button">Salir</button>
      </div>
    </header>

    <main>
      <aside class="sidebar">
        <div class="tabs" id="tabs">
          <button class="tab-btn active" data-tab="inscripcion">Inscripci√≥n <small>zonas y turnos</small></button>
          <button class="tab-btn" data-tab="galeria">Galer√≠a <small>obras de alumnos</small></button>
          <button class="tab-btn" data-tab="destacados">Alumnos Destacados <small>expo & 2025</small></button>
          <button class="tab-btn" data-tab="lapicini">Mundo Lapicini <small>cap√≠tulo 1</small></button>
          <button class="tab-btn" data-tab="sobre">Sobre Maxi <small>historia y redes</small></button>
          <button class="tab-btn" data-tab="admin" id="tabAdmin">Panel Admin MC <small>solo profe</small></button>
        </div>
      </aside>

      <section class="content">
        <!-- INSCRIPCION -->
        <div class="section active" id="inscripcion">
          <div class="title">
            <div>
              <h2>Inscripci√≥n</h2>
              <p>Eleg√≠ sede y horario. Luego envi√°s la solicitud por WhatsApp (inscripci√≥n/pago).</p>
            </div>
            <span class="badge">Cupos por turno: 20</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Formulario</h3>

              <label>Nombre completo</label>
              <input id="inNombre" placeholder="Ej: Juan P√©rez"/>

              <label>Correo electr√≥nico</label>
              <input id="inEmail" type="email" placeholder="Ej: alumno@gmail.com"/>

              <label>Selecciona la zona</label>
              <select id="inZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Selecciona el horario</label>
              <select id="inHorario">
                <option value="">Seleccionar</option>
              </select>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnGuardarInscripcion" type="button">Guardar selecci√≥n</button>
                <a class="btn ghost" id="btnWhatsapp" href="#" target="_blank" rel="noopener">Enviar WhatsApp</a>
              </div>

              <p class="hint">üí° Guardar selecci√≥n arma el WhatsApp con tus datos y el horario.</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Horarios por sede</h3>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>R√≠o Cuarto (Mar, Mi√©, Jue)</strong>
                <div class="small">Ma√±ana: 08:30‚Äì10:00 ‚Ä¢ 10:00‚Äì11:30</div>
                <div class="small">Tarde: 16:00‚Äì17:30 ‚Ä¢ 17:30‚Äì19:00 ‚Ä¢ 19:00‚Äì20:30</div>
              </div>

              <div class="hr"></div>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>Las Vertientes (Lunes)</strong>
                <div class="small">Ni√±os: 14:00‚Äì15:30 o 17:30‚Äì19:00</div>
                <div class="small">Adultos: 15:30‚Äì17:30</div>
              </div>

              <div class="hr"></div>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>Alcira Gigena (Viernes)</strong>
                <div class="small">Ni√±os: 15:00‚Äì16:30 o 18:30‚Äì20:00</div>
                <div class="small">Adultos: 16:30‚Äì18:30</div>
              </div>
            </div>
          </div>
        </div>

        <!-- GALERIA (local por ahora) -->
        <div class="section" id="galeria">
          <div class="title">
            <div>
              <h2>Galer√≠a de Arte MC</h2>
              <p>Sub√≠ obras por sede (guardado local por ahora). Luego lo pasamos a Storage.</p>
            </div>
            <span class="badge">Expo por zonas</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Subir obra</h3>
              <label>Sede</label>
              <select id="galZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Nombre del alumno (opcional)</label>
              <input id="galAutor" placeholder="Ej: Sof√≠a / Tom√°s / etc."/>

              <label>Imagen de la obra</label>
              <input id="galFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAgregarObra" type="button">Agregar a Galer√≠a</button>
                <button class="btn danger" id="btnLimpiarGaleria" type="button">Limpiar (este dispositivo)</button>
              </div>
              <p class="hint">Para 200 alumnos y que todos vean lo mismo: Storage + Firestore.</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Conteo</h3>
              <div class="row" style="margin-bottom:10px">
                <span class="badge" id="countRC">R√≠o Cuarto: 0</span>
                <span class="badge" id="countLV">Las Vertientes: 0</span>
                <span class="badge" id="countAG">Alcira Gigena: 0</span>
              </div>
              <p class="hint">Las obras se guardan en el navegador donde se suben.</p>
            </div>
          </div>

          <div class="hr"></div>
          <div id="galeriaGrid" class="gallery"></div>
        </div>

        <!-- DESTACADOS (local por ahora) -->
        <div class="section" id="destacados">
          <div class="title">
            <div>
              <h2>Alumnos Destacados</h2>
              <p>Reconocimientos por compromiso, evoluci√≥n y pasi√≥n por el arte (local por ahora).</p>
            </div>
            <span class="badge">Destacados 2025</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Agregar destacado</h3>

              <label>Sede</label>
              <select id="desZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Nombre del alumno</label>
              <input id="desNombre" placeholder="Ej: Sof√≠a"/>

              <label>A√±o</label>
              <input id="desAnio" placeholder="Ej: 2025" value="2025"/>

              <label>Foto (obra o retrato)</label>
              <input id="desFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAgregarDest" type="button">Agregar destacado</button>
                <button class="btn danger" id="btnLimpiarDest" type="button">Limpiar (este dispositivo)</button>
              </div>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Vista por sedes</h3>
              <div class="row">
                <span class="badge" id="countDRC">R√≠o Cuarto: 0</span>
                <span class="badge" id="countDLV">Las Vertientes: 0</span>
                <span class="badge" id="countDAG">Alcira Gigena: 0</span>
              </div>
              <p class="hint">Despu√©s lo hacemos global en Firestore.</p>
            </div>
          </div>

          <div class="hr"></div>
          <h3 style="margin:0 0 10px">Galer√≠a de destacados</h3>
          <div id="destGrid" class="gallery"></div>
        </div>

        <!-- LAPICINI -->
        <div class="section" id="lapicini">
          <div class="title">
            <div>
              <h2>Mundo Lapicini</h2>
              <p>Historia, cap√≠tulos y tienda. Cap√≠tulo 1 requiere acceso habilitado (pago confirmado).</p>
            </div>
            <span class="badge" id="badgeAcceso">Acceso: ...</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Historia</h3>
              <p class="small" style="margin-top:0">
                Lapicini nace como una creaci√≥n colectiva dentro de la Academia: una elecci√≥n entre alumnos que fue tomando forma
                hasta convertirse en un personaje con prop√≥sito. En la historia, Lapicini recibe una luz ‚Äîun don de parte de Dios‚Äî
                y decide compartirlo a trav√©s del dibujo. En cada cap√≠tulo, el dibujo no solo representa: tambi√©n acompa√±a,
                restaura y ayuda a sanar el coraz√≥n.
              </p>
              <div class="hr"></div>
              <a class="btn ghost" href="https://youtu.be/IJ14qcU9R-8?feature=shared" target="_blank" rel="noopener">
                Canci√≥n oficial: Lapicini - Dibuja un √Årbol
              </a>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Desbloqueo Cap√≠tulo 1</h3>
              <p class="small" style="margin-top:0">
                Ped√≠ el desbloqueo por WhatsApp. Maxi confirma el pago (o efectivo) y habilita el acceso.
              </p>
              <a class="btn primary" id="btnWAUnlock" href="#" target="_blank" rel="noopener">Desbloquear por WhatsApp</a>
              <p class="hint">El desbloqueo se controla desde ‚ÄúPanel Admin MC‚Äù.</p>
            </div>

            <div class="card" id="cap1Locked">
              <h3 style="margin:0 0 8px">Cap√≠tulo 1 (Bloqueado)</h3>
              <p class="small">üîí Este contenido se habilita cuando tu acceso est√© confirmado.</p>
            </div>

            <div class="card" id="cap1Open" style="display:none">
              <h3 style="margin:0 0 8px">Cap√≠tulo 1 (Habilitado)</h3>
              <div class="video">
                <iframe
                  src="https://www.youtube.com/embed/4NryFERyUlk"
                  title="Lapicini Cap√≠tulo 1"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen></iframe>
              </div>
              <div class="hr"></div>
              <a class="btn primary" href="https://youtu.be/4NryFERyUlk" target="_blank" rel="noopener">Abrir en YouTube</a>
            </div>
          </div>

          <div class="hr"></div>

          <div class="title">
            <div>
              <h2>Tienda Lapicini</h2>
              <p>Sub√≠ fotos por categor√≠as para generar deseo de compra (WhatsApp directo). (Local por ahora)</p>
            </div>
            <span class="badge">Productos</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Agregar producto</h3>

              <label>Categor√≠a</label>
              <select id="prodCat">
                <option value="Remera - Dise√±o 1">Remera - Dise√±o 1</option>
                <option value="Remera - Dise√±o 2">Remera - Dise√±o 2</option>
                <option value="Remera - Dise√±o 3">Remera - Dise√±o 3</option>
                <option value="Taza">Taza</option>
                <option value="Libro Desaf√≠o">Libro Desaf√≠o</option>
                <option value="Rompecabezas">Rompecabezas</option>
                <option value="Accesorios / L√°pices">Accesorios / L√°pices</option>
                <option value="Colecci√≥n / Juguetes">Colecci√≥n / Juguetes</option>
              </select>

              <label>Nombre del producto</label>
              <input id="prodName" placeholder="Ej: Remera Lapicini edici√≥n 2025"/>

              <label>Detalle (opcional)</label>
              <input id="prodDesc" placeholder="Ej: talles, precio, colores, etc."/>

              <label>Foto</label>
              <input id="prodFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAddProd" type="button">Agregar</button>
                <button class="btn danger" id="btnClearProd" type="button">Limpiar (este dispositivo)</button>
              </div>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Ver por categor√≠a</h3>
              <label>Filtrar</label>
              <select id="prodFilter">
                <option value="TODOS">TODOS</option>
                <option value="Remera - Dise√±o 1">Remera - Dise√±o 1</option>
                <option value="Remera - Dise√±o 2">Remera - Dise√±o 2</option>
                <option value="Remera - Dise√±o 3">Remera - Dise√±o 3</option>
                <option value="Taza">Taza</option>
                <option value="Libro Desaf√≠o">Libro Desaf√≠o</option>
                <option value="Rompecabezas">Rompecabezas</option>
                <option value="Accesorios / L√°pices">Accesorios / L√°pices</option>
                <option value="Colecci√≥n / Juguetes">Colecci√≥n / Juguetes</option>
              </select>
            </div>
          </div>

          <div class="hr"></div>
          <div id="prodGrid" class="gallery"></div>
        </div>
        <!-- CAP√çTULO 2 - ESCENAS -->
<div class="hr"></div>

<div class="title">
  <div>
    <h2>Cap√≠tulo 2 ‚Äî Escenas & Detalles</h2>
    <p>Momentos, arte y atm√≥sferas del universo Lapicini. Contenido visual y narrativo.</p>
  </div>
  <span class="badge">Cap√≠tulo 2</span>
</div>

<div class="grid">
  <!-- Escena 1 -->
  <div class="card">
    <h3 style="margin:0 0 8px">Escena 1 ‚Äî El despertar</h3>
    <p class="small">
      Primeros indicios de la luz. Lapicini comienza a comprender que el dibujo
      no solo representa, sino que transforma.
    </p>
    <div class="thumb" style="margin-top:10px">
      <img src="escena1.jpg" alt="Escena 1 Lapicini">
      <div class="cap">Boceto conceptual ‚Ä¢ Cap√≠tulo 2</div>
    </div>
  </div>

  <!-- Escena 2 -->
  <div class="card">
    <h3 style="margin:0 0 8px">Escena 2 ‚Äî La prueba</h3>
    <p class="small">
      El conflicto aparece. La luz se pone a prueba y el trazo se vuelve decisi√≥n.
    </p>
    <div class="thumb" style="margin-top:10px">
      <img src="escena2.jpg" alt="Escena 2 Lapicini">
      <div class="cap">Ilustraci√≥n narrativa ‚Ä¢ Cap√≠tulo 2</div>
    </div>
  </div>

  <!-- Escena 3 -->
  <div class="card">
    <h3 style="margin:0 0 8px">Escena 3 ‚Äî El mensaje</h3>
    <p class="small">
      Lapicini entiende que el don recibido debe compartirse.
      El arte como puente y sanaci√≥n.
    </p>
    <div class="thumb" style="margin-top:10px">
      <img src="escena3.jpg" alt="Escena 3 Lapicini">
      <div class="cap">Arte final ‚Ä¢ Cap√≠tulo 2</div>
    </div>
  </div>
</div>

        <!-- SOBRE -->
        <div class="section" id="sobre">
          <div class="title">
            <div>
              <h2>Sobre Maxi</h2>
              <p>V√≠ctor Mauro Maximiliano Cortez (Maxi Cortez) ‚Äî fundador de Academia MC y del cortometraje Lapicini.</p>
            </div>
            <span class="badge">30/12/1994</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Historia</h3>
              <p class="small" style="margin-top:0">
                Maxi comenz√≥ humildemente el camino del arte: caminaba mucho para ir casa a casa ofreciendo clases de dibujo y retratos.
                Hoy, con 17 a√±os de experiencia en dibujo realista y 9 a√±os como profesor, impulsa una comunidad art√≠stica para ni√±os,
                adolescentes y adultos, sin necesidad de conocimientos previos.
              </p>

              <div class="hr"></div>
              <h3 style="margin:0 0 8px">Redes</h3>
              <div class="row">
                <a class="btn ghost" href="https://www.instagram.com/maxicortez.dibujos?igsh=ZHh2YXVsdzdxa2sy" target="_blank" rel="noopener">Instagram personal</a>
                <a class="btn ghost" href="https://www.instagram.com/academiadearte_mc?igsh=b3J6dng0eW52MWJo" target="_blank" rel="noopener">Instagram Academia</a>
                <a class="btn ghost" href="https://www.facebook.com/share/16iud3rkDi/?mibextid=wwXIfr" target="_blank" rel="noopener">Facebook personal</a>
                <a class="btn ghost" href="https://www.facebook.com/share/1QG694BKdA/?mibextid=wwXIfr" target="_blank" rel="noopener">Facebook Academia</a>
                <a class="btn ghost" href="https://www.tiktok.com/@maxicortez.dibujos?_r=1&_t=ZM-923pKKQAlCN" target="_blank" rel="noopener">TikTok</a>
                <a class="btn ghost" href="https://youtube.com/@maxicortez.dibujos?si=YU2s9zo3TdHjlh1T" target="_blank" rel="noopener">YouTube</a>
              </div>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Contacto</h3>
              <p class="small">üì© Email: <a href="mailto:maurocortez17@gmail.com" style="color:var(--accent)">maurocortez17@gmail.com</a></p>
              <p class="small">üì≤ WhatsApp: <span style="color:var(--accent)">+54 358 4361289</span></p>
              <a class="btn primary" id="btnWhatsappSobre" href="#" target="_blank" rel="noopener">Hablar por WhatsApp</a>
            </div>
          </div>
        </div>

        <!-- ADMIN -->
        <div class="section" id="admin">
          <div class="title">
            <div>
              <h2>Panel Admin MC</h2>
              <p>Solo profesor. Activ√° ‚ÄúPago Lapicini‚Äù para desbloquear Cap√≠tulo 1 (Firestore).</p>
            </div>
            <span class="badge">Admin: maurocortez17@gmail.com</span>
          </div>

          <div class="card">
            <h3 style="margin:0 0 8px">Usuarios registrados (Firestore)</h3>
            <div class="row" style="margin-bottom:10px">
              <button class="btn ghost" id="btnRefrescarAdmin" type="button">Refrescar</button>
            </div>

            <div style="overflow:auto">
              <table>
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Pago Lapicini</th>
                    <th>Acci√≥n</th>
                  </tr>
                </thead>
                <tbody id="adminBody"></tbody>
              </table>
            </div>

            <p class="hint">Pr√≥ximo paso: pagos mensuales y cupos por turno.</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      ¬© <span id="year"></span> Academia de Arte MC ‚Äî Maxi Cortez ‚Ä¢ Hecho con amor y visi√≥n üíö
    </footer>
  </div>

  <!-- ======= APP SCRIPT (Firebase + UI) ======= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      collection,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    // ===== CONFIG =====
    const WHATSAPP = "5493584361289";
    const ADMIN_EMAIL = "maurocortez17@gmail.com";

    const firebaseConfig = {
      apiKey: "AIzaSyC3UhAIQewxZcdOUoeDYHNqZg5E0MlPYaE",
      authDomain: "academia-mc-e0a6e.firebaseapp.com",
      projectId: "academia-mc-e0a6e",
      storageBucket: "academia-mc-e0a6e.firebasestorage.app",
      messagingSenderId: "863214804042",
      appId: "1:863214804042:web:d85896ad336e5847341ab3"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== Helpers =====
    const $ = (id)=>document.getElementById(id);
    function waLink(text){ return `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(text)}`; }
    function toast(msg){ alert(msg); }
    function showGate(){ $("gate").classList.add("show"); document.body.style.overflow="hidden"; }
    function hideGate(){ $("gate").classList.remove("show"); document.body.style.overflow=""; }

    // ===== OJITO =====
    document.querySelectorAll(".eye").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-eye");
        const input = $(id);
        if(!input) return;
        input.type = (input.type === "password") ? "text" : "password";
      });
    });

    // ===== Gate toggle =====
    const loginBox = $("loginBox");
    const registerBox = $("registerBox");
    $("btnSwitchGate").addEventListener("click", ()=>{
      loginBox.style.display = "none";
      registerBox.style.display = "block";
    });
    $("btnBackLogin").addEventListener("click", ()=>{
      registerBox.style.display = "none";
      loginBox.style.display = "block";
    });

    // ===== Tabs =====
    const tabButtons = document.querySelectorAll(".tab-btn");
    const sections = document.querySelectorAll(".content .section");
    tabButtons.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        tabButtons.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const id = btn.dataset.tab;
        sections.forEach(s=>s.classList.toggle("active", s.id === id));
      });
    });

    // ===== Horarios =====
    const horariosPorZona = {
      "R√≠o Cuarto": [
        "Ma√±ana: 08:30 a 10:00",
        "Ma√±ana: 10:00 a 11:30",
        "Tarde: 16:00 a 17:30",
        "Tarde: 17:30 a 19:00",
        "Tarde: 19:00 a 20:30"
      ],
      "Las Vertientes": [
        "Lunes (Ni√±os): 14:00 a 15:30",
        "Lunes (Adultos): 15:30 a 17:30",
        "Lunes (Ni√±os): 17:30 a 19:00"
      ],
      "Alcira Gigena": [
        "Viernes (Ni√±os): 15:00 a 16:30",
        "Viernes (Adultos): 16:30 a 18:30",
        "Viernes (Ni√±os): 18:30 a 20:00"
      ]
    };
    const zonaSel = $("inZona");
    const horarioSel = $("inHorario");
    function cargarHorarios(){
      const zona = zonaSel.value;
      horarioSel.innerHTML = `<option value="">Seleccionar</option>`;
      (horariosPorZona[zona] || []).forEach(h=>{
        const opt = document.createElement("option");
        opt.value = h;
        opt.textContent = h;
        horarioSel.appendChild(opt);
      });
    }
    zonaSel.addEventListener("change", cargarHorarios);
    cargarHorarios();

    // ===== Local storage helpers (galer√≠a/destacados/tienda local) =====
    function readLS(key, fallback){
      try{ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
      catch(e){ return fallback; }
    }
    function saveLS(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
    function fileToDataURL(file){
      return new Promise((resolve, reject)=>{
        const fr = new FileReader();
        fr.onload = ()=> resolve(fr.result);
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    // ===== WhatsApp buttons =====
    function updateWhatsappButtons(){
      $("btnWhatsappHeader").href = waLink("Hola Maxi! Quiero informaci√≥n de inscripci√≥n en Academia de Arte MC.");
      $("btnWhatsappSobre").href = waLink("Hola Maxi! Quiero informaci√≥n para inscribirme en Academia de Arte MC.");
    }
    updateWhatsappButtons();

    function buildWhatsappText(nombre, email, zona, horario){
      return `Hola Maxi! Quiero inscribirme en Academia de Arte MC.
Nombre: ${nombre}
Email: ${email}
Sede: ${zona}
Horario: ${horario}
Quiero confirmar inscripci√≥n y pago.`;
    }
    $("btnGuardarInscripcion").addEventListener("click", ()=>{
      const nombre = $("inNombre").value.trim();
      const email  = $("inEmail").value.trim().toLowerCase();
      const zona   = $("inZona").value;
      const horario= $("inHorario").value;

      if(!nombre || !email || !zona || !horario){
        toast("Complet√° nombre, email, zona y horario.");
        return;
      }
      const msg = buildWhatsappText(nombre, email, zona, horario);
      $("btnWhatsapp").href = waLink(msg);
      toast("‚úÖ Guardado. Ahora toc√° ‚ÄúEnviar WhatsApp‚Äù.");
    });

    // ===== Galer√≠a (local) =====
    function getObras(){ return readLS("mc_obras", []); }
    function setObras(arr){ saveLS("mc_obras", arr); }
    function renderGaleria(){
      const obras = getObras();
      const grid = $("galeriaGrid");
      grid.innerHTML = "";

      $("countRC").textContent = `R√≠o Cuarto: ${obras.filter(o=>o.zona==="R√≠o Cuarto").length}`;
      $("countLV").textContent = `Las Vertientes: ${obras.filter(o=>o.zona==="Las Vertientes").length}`;
      $("countAG").textContent = `Alcira Gigena: ${obras.filter(o=>o.zona==="Alcira Gigena").length}`;

      if(obras.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">Todav√≠a no hay obras cargadas en este dispositivo.</div>`;
        return;
      }
      obras.slice().reverse().forEach(o=>{
        const el = document.createElement("div");
        el.className = "thumb";
        el.innerHTML = `
          <div class="tag">${o.zona}</div>
          <img src="${o.img}" alt="Obra">
          <div class="cap">Autor: ${o.autor || "Alumno/a"}</div>
        `;
        grid.appendChild(el);
      });
    }
    $("btnAgregarObra").addEventListener("click", async ()=>{
      const zona = $("galZona").value;
      const autor = $("galAutor").value.trim();
      const file = $("galFile").files?.[0];
      if(!file){ toast("Eleg√≠ una imagen."); return; }
      const img = await fileToDataURL(file);
      const obras = getObras();
      obras.push({ zona, autor, img, createdAt: Date.now() });
      setObras(obras);
      $("galFile").value = "";
      $("galAutor").value = "";
      renderGaleria();
      toast("‚úÖ Obra agregada (local).");
    });
    $("btnLimpiarGaleria").addEventListener("click", ()=>{
      if(confirm("¬øBorrar toda la galer√≠a guardada en este dispositivo?")){
        localStorage.removeItem("mc_obras");
        renderGaleria();
      }
    });

    // ===== Destacados (local) =====
    function getDest(){ return readLS("mc_destacados", []); }
    function setDest(arr){ saveLS("mc_destacados", arr); }
    function renderDestacados(){
      const arr = getDest();
      $("countDRC").textContent = `R√≠o Cuarto: ${arr.filter(d=>d.zona==="R√≠o Cuarto").length}`;
      $("countDLV").textContent = `Las Vertientes: ${arr.filter(d=>d.zona==="Las Vertientes").length}`;
      $("countDAG").textContent = `Alcira Gigena: ${arr.filter(d=>d.zona==="Alcira Gigena").length}`;

      const grid = $("destGrid");
      grid.innerHTML = "";
      if(arr.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">Todav√≠a no agregaste alumnos destacados en este dispositivo.</div>`;
        return;
      }
      arr.slice().reverse().forEach(d=>{
        const el = document.createElement("div");
        el.className = "thumb";
        el.innerHTML = `
          <div class="tag">${d.zona} ‚Ä¢ ${d.anio}</div>
          <img src="${d.img}" alt="Destacado">
          <div class="cap"><b>${d.nombre}</b><br><span class="small">Alumno destacado</span></div>
        `;
        grid.appendChild(el);
      });
    }
    $("btnAgregarDest").addEventListener("click", async ()=>{
      const zona = $("desZona").value;
      const nombre = $("desNombre").value.trim();
      const anio = $("desAnio").value.trim() || "2025";
      const file = $("desFile").files?.[0];
      if(!nombre || !file){ toast("Nombre + imagen."); return; }
      const img = await fileToDataURL(file);
      const arr = getDest();
      arr.push({ zona, nombre, anio, img, createdAt: Date.now() });
      setDest(arr);
      $("desNombre").value = "";
      $("desFile").value = "";
      renderDestacados();
      toast("‚≠ê Destacado agregado (local).");
    });
    $("btnLimpiarDest").addEventListener("click", ()=>{
      if(confirm("¬øBorrar todos los destacados en este dispositivo?")){
        localStorage.removeItem("mc_destacados");
        renderDestacados();
      }
    });

    // ===== Tienda (local) =====
    function getProducts(){ return readLS("mc_products", []); }
    function setProducts(arr){ saveLS("mc_products", arr); }
    function renderProducts(){
      const grid = $("prodGrid");
      grid.innerHTML = "";
      const filter = $("prodFilter").value;
      const arrAll = getProducts();
      const arr = (filter === "TODOS") ? arrAll : arrAll.filter(p=>p.cat === filter);

      if(arr.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">No hay productos en esta categor√≠a (en este dispositivo).</div>`;
        return;
      }

      arr.slice().reverse().forEach(p=>{
        const el = document.createElement("div");
        el.className = "thumb";
        const waMsg = `Hola Maxi! Quiero comprar un producto de Lapicini.
Producto: ${p.name}
Categor√≠a: ${p.cat}
Detalle: ${p.desc || "-"}
Mi email: ${(auth.currentUser?.email || "-")}`;
        el.innerHTML = `
          <div class="tag">${p.cat}</div>
          <img src="${p.img}" alt="Producto">
          <div class="cap">
            <b>${p.name}</b><br>
            <span class="small">${p.desc || ""}</span><br><br>
            <a class="btn primary" style="width:100%" href="${waLink(waMsg)}" target="_blank" rel="noopener">Comprar por WhatsApp</a>
          </div>
        `;
        grid.appendChild(el);
      });
    }
    $("btnAddProd").addEventListener("click", async ()=>{
      const cat = $("prodCat").value;
      const name = $("prodName").value.trim();
      const desc = $("prodDesc").value.trim();
      const file = $("prodFile").files?.[0];
      if(!name || !file){ toast("Nombre + foto."); return; }
      const img = await fileToDataURL(file);
      const arr = getProducts();
      arr.push({ cat, name, desc, img, createdAt: Date.now() });
      setProducts(arr);
      $("prodName").value = "";
      $("prodDesc").value = "";
      $("prodFile").value = "";
      renderProducts();
      toast("üõçÔ∏è Producto agregado (local).");
    });
    $("btnClearProd").addEventListener("click", ()=>{
      if(confirm("¬øBorrar todos los productos en este dispositivo?")){
        localStorage.removeItem("mc_products");
        renderProducts();
      }
    });
    $("prodFilter").addEventListener("change", renderProducts);

    // ===== Firebase Auth: Register/Login/Logout =====
    $("btnRegister").addEventListener("click", async ()=>{
      const nombre = $("regNombre").value.trim();
      const email  = $("regEmail").value.trim().toLowerCase();
      const pass   = $("regPass").value;

      if(!nombre || !email || !pass){
        toast("Complet√° nombre, email y contrase√±a.");
        return;
      }

      try{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(cred.user, { displayName: nombre });

        await setDoc(doc(db, "users", cred.user.uid), {
          nombre,
          email,
          paidLapicini: (email === ADMIN_EMAIL),
          createdAt: Date.now()
        });

        toast("‚úÖ Cuenta creada. Entrando...");
      }catch(e){
        toast(e?.message || String(e));
      }
    });

    $("btnLogin").addEventListener("click", async ()=>{
      const email = $("loginEmail").value.trim().toLowerCase();
      const pass  = $("loginPass").value;
      if(!email || !pass){ toast("Complet√° email y contrase√±a."); return; }

      try{
        await signInWithEmailAndPassword(auth, email, pass);
        toast("‚úÖ Bienvenido/a.");
      }catch(e){
        toast("Email o contrase√±a incorrectos.");
      }
    });

    $("btnLogout").addEventListener("click", async ()=>{
      await signOut(auth);
      toast("Sesi√≥n cerrada.");
      location.reload();
    });

    // ===== Lapicini Paywall (Firestore) =====
    function updateLapiciniAccessUI(paid){
      $("badgeAcceso").textContent = paid ? "Acceso: HABILITADO ‚úÖ" : "Acceso: BLOQUEADO üîí";
      $("cap1Locked").style.display = paid ? "none" : "block";
      $("cap1Open").style.display = paid ? "block" : "none";

      const msg = `Hola Maxi! Quiero desbloquear el Cap√≠tulo 1 de Lapicini.
Mi email de registro es: ${auth.currentUser?.email || "-"}
Quiero el link de pago y habilitaci√≥n.`;
      $("btnWAUnlock").href = waLink(msg);
    }

    // ===== Admin panel (Firestore) =====
    async function refreshAdmin(){
      const body = $("adminBody");
      body.innerHTML = "";
      if(auth.currentUser?.email !== ADMIN_EMAIL){
        body.innerHTML = `<tr><td colspan="4" class="small">Acceso denegado. Solo profesor.</td></tr>`;
        return;
      }

      const qy = query(collection(db, "users"), orderBy("createdAt", "desc"));
      const snap = await getDocs(qy);
      if(snap.empty){
        body.innerHTML = `<tr><td colspan="4" class="small">Todav√≠a no hay usuarios.</td></tr>`;
        return;
      }

      snap.forEach(docSnap=>{
        const u = docSnap.data();
        const uid = docSnap.id;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.nombre || "-"}</td>
          <td>${u.email || "-"}</td>
          <td><span class="badge">${u.paidLapicini ? "S√≠ ‚úÖ" : "No üîí"}</span></td>
          <td class="row" style="gap:8px">
            <button class="btn ghost" data-toggle="${uid}" type="button">Toggle Pago</button>
          </td>
        `;
        body.appendChild(tr);
      });

      body.querySelectorAll("button[data-toggle]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const uid = btn.getAttribute("data-toggle");
          const ref = doc(db, "users", uid);
          const snap = await getDoc(ref);
          if(!snap.exists()) return;
          const cur = snap.data();
          const next = !cur.paidLapicini;
          await updateDoc(ref, { paidLapicini: next });

          if(auth.currentUser?.uid === uid){
            updateLapiciniAccessUI(next);
          }
          await refreshAdmin();
        });
      });
    }
    $("btnRefrescarAdmin").addEventListener("click", refreshAdmin);

    function enforceAdminVisibility(isAdmin){
      $("tabAdmin").style.display = isAdmin ? "flex" : "none";
    }

    // ===== Auth state =====
    onAuthStateChanged(auth, async (user)=>{
      $("year").textContent = new Date().getFullYear();

      if(!user){
        showGate();
        enforceAdminVisibility(false);
        return;
      }
      hideGate();

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      let profile = null;
      if(snap.exists()){
        profile = snap.data();
      } else {
        profile = { nombre: user.displayName || "Alumno/a", email: user.email, paidLapicini: false, createdAt: Date.now() };
        await setDoc(ref, profile);
      }

      $("userLine").textContent = `Sesi√≥n: ${profile.nombre} ‚Ä¢ ${profile.email}`;
      $("inNombre").value = profile.nombre || "";
      $("inEmail").value  = profile.email || "";

      const isAdmin = (profile.email === ADMIN_EMAIL);
      enforceAdminVisibility(isAdmin);
      updateLapiciniAccessUI(!!profile.paidLapicini);

      renderGaleria();
      renderDestacados();
      renderProducts();
      updateWhatsappButtons();

      if(isAdmin){
        await refreshAdmin();
      }
    });

    // Inicial render local:
    renderGaleria();
    renderDestacados();
    renderProducts();
    updateWhatsappButtons();
  </script>
</body>
</html>

