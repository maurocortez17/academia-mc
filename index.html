<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Academia de Arte MC | Maxi Cortez</title>
  <meta name="description" content="Plataforma Academia de Arte MC. Registro, inscripci√≥n, galer√≠a, alumnos destacados y Mundo Lapicini." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#032f2b;
      --bg2:#0a6b63;
      --stroke: rgba(255,255,255,.18);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent:#32e3c0;
      --accent2:#00bcd4;
      --danger:#ff5d5d;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background: radial-gradient(1200px 600px at 15% 10%, rgba(50,227,192,.35), transparent 55%),
                  radial-gradient(900px 450px at 85% 20%, rgba(0,188,212,.25), transparent 55%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    .wrap{ width:min(1120px, 92vw); margin:18px auto 40px; position:relative; }
    @media (max-width:520px){ .wrap{ width:94vw; margin-top:14px; } }

    .deco{ position:absolute; inset:0; pointer-events:none; z-index:0; }
    .deco img{ position:absolute; opacity:.18; filter: drop-shadow(0 20px 40px rgba(0,0,0,.5)); }
    .deco .logo{ width:170px; left:-30px; top:-20px; }
    .deco .lapicini{ width:240px; right:-40px; bottom:-40px; opacity:.22; }
    @media (max-width:520px){
      .deco .logo{ width:118px; left:-18px; top:-10px; opacity:.14;}
      .deco .lapicini{ width:168px; right:-22px; bottom:-22px; opacity:.16;}
    }

    header{
      position:relative; z-index:1;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:16px 14px;
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }
    .brand{ display:flex; gap:12px; align-items:center; min-width:0; }
    .brand-badge{
      width:44px;height:44px;border-radius:14px;
      border:1px solid var(--stroke);
      background: radial-gradient(circle at 30% 25%, rgba(50,227,192,.6), rgba(255,255,255,.08));
      display:grid;place-items:center;
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
      flex:0 0 auto;
    }
    .brand-badge span{ font-weight:800; letter-spacing:.5px; }
    .brand h1{
      margin:0;
      font-size: clamp(16px, 2.2vw, 22px);
      line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .header-actions{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--txt); font-size:12px;
      cursor:pointer; text-decoration:none; user-select:none;
      transition:.2s;
    }
    .pill:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }
    .pill.primary{
      background: linear-gradient(135deg, rgba(50,227,192,.90), rgba(0,188,212,.75));
      border:0; color:#052a26; font-weight:700;
    }

    main{
      position:relative; z-index:1;
      margin-top:14px;
      display:grid;
      grid-template-columns: 290px 1fr;
      gap:14px;
    }
    @media (max-width:900px){ main{ grid-template-columns: 1fr; } }

    .sidebar{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.07);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .tabs{ display:flex; flex-direction:column; }
    .tab-btn{
      border:0; background: transparent; color:var(--txt);
      padding:14px 14px;
      display:flex; justify-content:space-between; align-items:center;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,.08);
      transition:.15s;
      font-size:14px;
      text-align:left;
    }
    .tab-btn:hover{ background: rgba(255,255,255,.06); }
    .tab-btn.active{
      background: linear-gradient(90deg, rgba(50,227,192,.25), rgba(0,188,212,.12));
    }
    .tab-btn small{ color:var(--muted); font-size:11px; }

    .content{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .section{ display:none; padding:16px; }
    .section.active{ display:block; }

    .title{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .title h2{ margin:0; font-size:18px; }
    .title p{ margin:6px 0 0; color:var(--muted); font-size:13px; }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:700px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:14px;
    }

    label{ display:block; margin:10px 0 6px; font-size:12px; color:var(--muted); }
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color:var(--txt);
      outline:none;
      font-size:14px;
    }
    textarea{ min-height:90px; resize:vertical; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .btn{
      border:0; border-radius:14px;
      padding:12px 14px;
      cursor:pointer; font-weight:700;
      transition:.18s;
      display:inline-flex; gap:8px;
      align-items:center; justify-content:center;
      text-decoration:none; user-select:none;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(50,227,192,.95), rgba(0,188,212,.75));
      color:#052a26;
    }
    .btn.ghost{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
      color:var(--txt);
    }
    .btn.danger{
      background: rgba(255,93,93,.18);
      border:1px solid rgba(255,93,93,.35);
      color:#ffd1d1;
    }
    .btn:hover{ transform: translateY(-1px); }

    .hint{ font-size:12px; color:var(--muted); margin:10px 0 0; }
    .hr{ height:1px; background: rgba(255,255,255,.10); margin:14px 0; }

    .badge{
      display:inline-flex; gap:6px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-size:12px; color:var(--txt);
      white-space:nowrap;
    }

    .gallery{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
    @media (max-width:1000px){ .gallery{ grid-template-columns: repeat(3, 1fr);} }
    @media (max-width:700px){ .gallery{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:430px){ .gallery{ grid-template-columns: 1fr;} }

    .thumb{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      overflow:hidden;
      position:relative;
    }
    .thumb img{ width:100%; height:170px; object-fit:cover; display:block; }
    .thumb .cap{ padding:10px; font-size:12px; color:var(--muted); }
    .thumb .tag{
      position:absolute; top:10px; left:10px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      padding:6px 10px; border-radius:999px;
      font-size:11px;
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
    }
    th, td{
      text-align:left;
      padding:10px;
      font-size:13px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:top;
    }
    th{ color:rgba(255,255,255,.80); font-weight:700; background: rgba(0,0,0,.12); }
    td{ color:rgba(255,255,255,.90); }
    .small{ font-size:12px; color:var(--muted); }

    .video{
      aspect-ratio: 16 / 9;
      width:100%;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      overflow:hidden;
      background: rgba(0,0,0,.2);
    }
    .video iframe{ width:100%; height:100%; border:0; }

    footer{ margin-top:14px; padding:12px 16px; color:rgba(255,255,255,.65); font-size:12px; text-align:center; }

    /* ===== LOGIN GATE ===== */
    .gate{
      position:fixed; inset:0; z-index:9999;
      display:none; align-items:center; justify-content:center;
      padding:16px;
      background: radial-gradient(900px 450px at 20% 10%, rgba(50,227,192,.25), transparent 60%),
                  radial-gradient(700px 400px at 80% 25%, rgba(0,188,212,.20), transparent 60%),
                  rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    .gate.show{ display:flex; }
    .gate-box{
      width:min(980px, 96vw);
      border:1px solid rgba(255,255,255,.20);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    }
    .gate-head{
      padding:16px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .gate-title{ display:flex; gap:10px; align-items:center; min-width:0; }
    .gate-title h2{
      margin:0; font-size:16px; line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .gate-title p{ margin:2px 0 0; color:var(--muted); font-size:12px; }
    .gate-body{
      padding:14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    @media (max-width:860px){ .gate-body{ grid-template-columns: 1fr; } }
    .gate-hero{
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:14px;
      background: rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
    }
    .gate-hero img{
      width:110px;
      opacity:.18;
      position:absolute;
      right:-10px;
      bottom:-10px;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.5));
    }
    .chip{
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius:999px;
      font-size:12px;
      color:rgba(255,255,255,.82);
    }
    .pw{
      position:relative;
    }
    .pw input{ padding-right:44px; }
    .eye{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color:rgba(255,255,255,.9);
      width:34px;
      height:34px;
      border-radius:12px;
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .eye:active{ transform:translateY(-50%) scale(.98); }
  </style>
</head>

<body>
  <!-- LOGIN / REGISTER GATE -->
  <div class="gate" id="gate">
    <div class="gate-box">
      <div class="gate-head">
        <div class="gate-title">
          <div class="brand-badge" aria-hidden="true"><span>MC</span></div>
          <div style="min-width:0">
            <h2>Acceso a Academia de Arte MC & Mundo Lapicini</h2>
            <p>Registrate o ingres√° para continuar ‚Ä¢ Prof. Maxi Cortez</p>
          </div>
        </div>
        <span class="badge">maurocortez17@gmail.com</span>
      </div>

      <div class="gate-body">
        <div class="gate-hero">
          <h3 style="margin:0 0 6px">¬øQu√© vas a encontrar adentro?</h3>
          <p class="small" style="margin:0 0 10px">
            Inscripci√≥n por sedes y turnos, galer√≠a, <b>alumnos destacados</b> y el <b>Mundo Lapicini</b>.
            El <b>Cap√≠tulo 1</b> se desbloquea con acceso habilitado (pago confirmado).
          </p>
          <div class="row" style="gap:8px">
            <span class="chip">R√≠o Cuarto</span>
            <span class="chip">Las Vertientes</span>
            <span class="chip">Alcira Gigena</span>
            <span class="chip">Destacados 2025</span>
            <span class="chip">Cap√≠tulo 1 bloqueado</span>
          </div>
          <img src="lapicini.png" alt="Lapicini"/>
          <div class="hr"></div>
          <a class="btn ghost" href="mailto:maurocortez17@gmail.com">Contactar por email</a>
        </div>

        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ingresar</h3>
            <button class="btn ghost" id="btnSwitchGate" type="button">Crear cuenta</button>
          </div>

          <div id="loginBox">
            <label>Email</label>
            <input id="loginEmail" type="email" placeholder="tuemail@gmail.com"/>

            <label>Contrase√±a</label>
            <div class="pw">
              <input id="loginPass" type="password" placeholder="tu contrase√±a"/>
              <div class="eye" data-eye="loginPass" title="Mostrar/Ocultar">üëÅÔ∏è</div>
            </div>

            <div class="row" style="margin-top:12px">
              <button class="btn primary" id="btnLogin" type="button">Ingresar</button>
              <button class="btn danger" id="btnResetLocal" type="button">Borrar sesi√≥n</button>
            </div>
            <p class="hint">Si sos alumno nuevo, toc√° ‚ÄúCrear cuenta‚Äù.</p>
          </div>

          <div id="registerBox" style="display:none">
            <label>Nombre completo</label>
            <input id="regNombre" placeholder="Ej: Juan P√©rez"/>

            <label>Email</label>
            <input id="regEmail" type="email" placeholder="Ej: alumno@gmail.com"/>

            <label>Contrase√±a</label>
            <div class="pw">
              <input id="regPass" type="password" placeholder="Eleg√≠ una contrase√±a"/>
              <div class="eye" data-eye="regPass" title="Mostrar/Ocultar">üëÅÔ∏è</div>
            </div>

            <div class="row" style="margin-top:12px">
              <button class="btn primary" id="btnRegister" type="button">Crear cuenta</button>
              <button class="btn ghost" id="btnBackLogin" type="button">Volver</button>
            </div>
            <p class="hint">Al crear la cuenta, entr√°s a la plataforma. El Cap√≠tulo 1 se habilita luego del pago.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="deco">
      <img class="logo" src="logo.png" alt="Logo Academia de Arte MC">
      <img class="lapicini" src="lapicini.png" alt="Lapicini">
    </div>

    <header>
      <div class="brand">
        <div class="brand-badge" aria-hidden="true"><span>MC</span></div>
        <div style="min-width:0">
          <h1>Academia de Arte MC ‚Äî Maxi Cortez</h1>
          <p id="userLine">Profesional ‚Ä¢ Para todas las edades ‚Ä¢ Sin conocimientos previos</p>
        </div>
      </div>

      <div class="header-actions">
        <a class="pill primary" id="btnWhatsappHeader" href="#" target="_blank" rel="noopener">WhatsApp</a>
        <a class="pill" href="mailto:maurocortez17@gmail.com">maurocortez17@gmail.com</a>
        <button class="pill" id="btnLogout" type="button">Salir</button>
      </div>
    </header>

    <main>
      <aside class="sidebar">
        <div class="tabs" id="tabs">
          <button class="tab-btn active" data-tab="inscripcion">Inscripci√≥n <small>zonas y turnos</small></button>
          <button class="tab-btn" data-tab="galeria">Galer√≠a <small>obras de alumnos</small></button>
          <button class="tab-btn" data-tab="destacados">Alumnos Destacados <small>expo & 2025</small></button>
          <button class="tab-btn" data-tab="lapicini">Mundo Lapicini <small>cap√≠tulo 1 bloqueado</small></button>
          <button class="tab-btn" data-tab="sobre">Sobre Maxi <small>historia y redes</small></button>
          <button class="tab-btn" data-tab="admin" id="tabAdmin">Panel Admin MC <small>solo profe</small></button>
        </div>
      </aside>

      <section class="content">
        <!-- INSCRIPCION -->
        <div class="section active" id="inscripcion">
          <div class="title">
            <div>
              <h2>Inscripci√≥n</h2>
              <p>Eleg√≠ sede y horario. Luego envi√°s la solicitud por WhatsApp (inscripci√≥n/pago).</p>
            </div>
            <span class="badge">Cupos por turno: 20</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Formulario</h3>

              <label>Nombre completo</label>
              <input id="inNombre" placeholder="Ej: Juan P√©rez"/>

              <label>Correo electr√≥nico</label>
              <input id="inEmail" type="email" placeholder="Ej: alumno@gmail.com"/>

              <label>Selecciona la zona</label>
              <select id="inZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Selecciona el horario</label>
              <select id="inHorario">
                <option value="">Seleccionar</option>
              </select>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnGuardarInscripcion" type="button">Guardar selecci√≥n</button>
                <a class="btn ghost" id="btnWhatsapp" href="#" target="_blank" rel="noopener">Enviar WhatsApp</a>
              </div>

              <p class="hint">üí° Guardar selecci√≥n arma el WhatsApp con tus datos y el horario.</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Horarios por sede</h3>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>R√≠o Cuarto (Mar, Mi√©, Jue)</strong>
                <div class="small">Ma√±ana: 08:30‚Äì10:00 ‚Ä¢ 10:00‚Äì11:30</div>
                <div class="small">Tarde: 16:00‚Äì17:30 ‚Ä¢ 17:30‚Äì19:00 ‚Ä¢ 19:00‚Äì20:30</div>
              </div>

              <div class="hr"></div>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>Las Vertientes (Lunes)</strong>
                <div class="small">Ni√±os: 14:00‚Äì15:30 o 17:30‚Äì19:00</div>
                <div class="small">Adultos: 15:30‚Äì17:30</div>
              </div>

              <div class="hr"></div>

              <div class="card" style="background:rgba(0,0,0,.14)">
                <strong>Alcira Gigena (Viernes)</strong>
                <div class="small">Ni√±os: 15:00‚Äì16:30 o 18:30‚Äì20:00</div>
                <div class="small">Adultos: 16:30‚Äì18:30</div>
              </div>
            </div>
          </div>
        </div>

        <!-- GALERIA -->
        <div class="section" id="galeria">
          <div class="title">
            <div>
              <h2>Galer√≠a de Arte MC</h2>
              <p>Sub√≠ obras por sede (guardado local por ahora).</p>
            </div>
            <span class="badge">Expo por zonas</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Subir obra</h3>
              <label>Sede</label>
              <select id="galZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Nombre del alumno (opcional)</label>
              <input id="galAutor" placeholder="Ej: Sof√≠a / Tom√°s / etc."/>

              <label>Imagen de la obra</label>
              <input id="galFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAgregarObra" type="button">Agregar a Galer√≠a</button>
                <button class="btn danger" id="btnLimpiarGaleria" type="button">Limpiar (este dispositivo)</button>
              </div>
              <p class="hint">Para 200 alumnos y que quede online para todos: Firebase.</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Conteo</h3>
              <div class="row" style="margin-bottom:10px">
                <span class="badge" id="countRC">R√≠o Cuarto: 0</span>
                <span class="badge" id="countLV">Las Vertientes: 0</span>
                <span class="badge" id="countAG">Alcira Gigena: 0</span>
              </div>
              <p class="hint">Las obras se guardan en el navegador donde se suben.</p>
            </div>
          </div>

          <div class="hr"></div>
          <div id="galeriaGrid" class="gallery"></div>
        </div>

        <!-- DESTACADOS -->
        <div class="section" id="destacados">
          <div class="title">
            <div>
              <h2>Alumnos Destacados</h2>
              <p>Reconocimientos por compromiso, evoluci√≥n y pasi√≥n por el arte. (Local por ahora.)</p>
            </div>
            <span class="badge">Destacados 2025</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Agregar destacado</h3>

              <label>Sede</label>
              <select id="desZona">
                <option value="R√≠o Cuarto">R√≠o Cuarto</option>
                <option value="Las Vertientes">Las Vertientes</option>
                <option value="Alcira Gigena">Alcira Gigena</option>
              </select>

              <label>Nombre del alumno</label>
              <input id="desNombre" placeholder="Ej: Sof√≠a"/>

              <label>A√±o</label>
              <input id="desAnio" placeholder="Ej: 2025" value="2025"/>

              <label>Foto (obra o retrato)</label>
              <input id="desFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAgregarDest" type="button">Agregar destacado</button>
                <button class="btn danger" id="btnLimpiarDest" type="button">Limpiar (este dispositivo)</button>
              </div>

              <p class="hint">Luego lo pasamos a Firebase para que sea global (todos lo vean igual).</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Vista por sedes</h3>
              <p class="small" style="margin-top:0">
                ‚úÖ R√≠o Cuarto ‚Ä¢ ‚úÖ Las Vertientes ‚Ä¢ ‚úÖ Alcira Gigena<br>
                Pod√©s destacar 1 obra por alumno (o m√°s si quer√©s).
              </p>
              <div class="hr"></div>
              <div class="row">
                <span class="badge" id="countDRC">R√≠o Cuarto: 0</span>
                <span class="badge" id="countDLV">Las Vertientes: 0</span>
                <span class="badge" id="countDAG">Alcira Gigena: 0</span>
              </div>
            </div>
          </div>

          <div class="hr"></div>
          <h3 style="margin:0 0 10px">Galer√≠a de destacados</h3>
          <div id="destGrid" class="gallery"></div>
        </div>

        <!-- LAPICINI (PAYWALL + TIENDA) -->
        <div class="section" id="lapicini">
          <div class="title">
            <div>
              <h2>Mundo Lapicini</h2>
              <p>Historia, escenas, cap√≠tulos y tienda. Cap√≠tulo 1 requiere acceso habilitado (pago confirmado).</p>
            </div>
            <span class="badge" id="badgeAcceso">Acceso: ...</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Historia (m√°s profunda)</h3>
              <p class="small" style="margin-top:0">
                Lapicini nace como una creaci√≥n colectiva dentro de la Academia: una elecci√≥n entre alumnos que fue tomando forma
                hasta convertirse en un personaje con prop√≥sito. En la historia, Lapicini recibe una luz ‚Äîun don de parte de Dios‚Äî
                y decide compartirlo a trav√©s del dibujo. En cada cap√≠tulo, el dibujo no solo representa: tambi√©n acompa√±a,
                restaura y ayuda a sanar el coraz√≥n.
              </p>
              <div class="hr"></div>
              <h3 style="margin:0 0 8px">Escenas & arte (para que subas vos)</h3>
              <p class="small" style="margin-top:0">
                Sub√≠ im√°genes de escenas/bocetos a tu repo (ej: <b>escena1.png</b>, <b>escena2.png</b>) y ac√° las pod√©s ir mostrando.
                (Si quer√©s, despu√©s lo automatizamos con galer√≠a).
              </p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Cap√≠tulo 1 (Desbloqueo)</h3>
              <p class="small" style="margin-top:0">
                Para ver el Cap√≠tulo 1, ped√≠ el desbloqueo por WhatsApp. Maxi confirma el pago (o efectivo) y habilita el acceso.
              </p>
              <a class="btn primary" id="btnWAUnlock" href="#" target="_blank" rel="noopener">Desbloquear por WhatsApp</a>

              <div class="hr"></div>
              <h3 style="margin:0 0 8px">Canci√≥n oficial</h3>
              <a class="btn ghost" href="https://youtu.be/IJ14qcU9R-8?feature=shared" target="_blank" rel="noopener">
                Lapicini - Dibuja un √Årbol (YouTube)
              </a>
            </div>

            <div class="card" id="cap1Locked">
              <h3 style="margin:0 0 8px">Cap√≠tulo 1 (Bloqueado)</h3>
              <p class="small">üîí Este contenido se habilita cuando tu acceso est√© confirmado.</p>
              <p class="hint">Si ya pagaste, Maxi lo habilita desde el Panel Admin (solo profe).</p>
            </div>

            <div class="card" id="cap1Open" style="display:none">
              <h3 style="margin:0 0 8px">Cap√≠tulo 1 (Habilitado)</h3>
              <div class="video">
                <iframe
                  src="https://www.youtube.com/embed/4NryFERyUlk"
                  title="Lapicini Cap√≠tulo 1"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen></iframe>
              </div>
              <div class="hr"></div>
              <a class="btn primary" href="https://youtu.be/4NryFERyUlk" target="_blank" rel="noopener">Abrir en YouTube</a>
            </div>
          </div>

          <div class="hr"></div>

          <div class="title">
            <div>
              <h2>Tienda Lapicini</h2>
              <p>Sub√≠ fotos y mostr√°las por categor√≠as para generar deseo de compra (WhatsApp directo).</p>
            </div>
            <span class="badge">Productos</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Agregar producto</h3>

              <label>Categor√≠a</label>
              <select id="prodCat">
                <option value="Remera - Dise√±o 1">Remera - Dise√±o 1</option>
                <option value="Remera - Dise√±o 2">Remera - Dise√±o 2</option>
                <option value="Remera - Dise√±o 3">Remera - Dise√±o 3</option>
                <option value="Taza">Taza</option>
                <option value="Libro Desaf√≠o">Libro Desaf√≠o</option>
                <option value="Rompecabezas">Rompecabezas</option>
                <option value="Accesorios / L√°pices">Accesorios / L√°pices</option>
                <option value="Colecci√≥n / Juguetes">Colecci√≥n / Juguetes</option>
              </select>

              <label>Nombre del producto</label>
              <input id="prodName" placeholder="Ej: Remera Lapicini edici√≥n 2025"/>

              <label>Detalle (opcional)</label>
              <input id="prodDesc" placeholder="Ej: talles, precio, colores, etc."/>

              <label>Foto</label>
              <input id="prodFile" type="file" accept="image/*"/>

              <div class="row" style="margin-top:12px">
                <button class="btn primary" id="btnAddProd" type="button">Agregar</button>
                <button class="btn danger" id="btnClearProd" type="button">Limpiar (este dispositivo)</button>
              </div>

              <p class="hint">Cada producto tendr√° bot√≥n ‚ÄúComprar por WhatsApp‚Äù.</p>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Ver por categor√≠a</h3>
              <label>Filtrar</label>
              <select id="prodFilter">
                <option value="TODOS">TODOS</option>
                <option value="Remera - Dise√±o 1">Remera - Dise√±o 1</option>
                <option value="Remera - Dise√±o 2">Remera - Dise√±o 2</option>
                <option value="Remera - Dise√±o 3">Remera - Dise√±o 3</option>
                <option value="Taza">Taza</option>
                <option value="Libro Desaf√≠o">Libro Desaf√≠o</option>
                <option value="Rompecabezas">Rompecabezas</option>
                <option value="Accesorios / L√°pices">Accesorios / L√°pices</option>
                <option value="Colecci√≥n / Juguetes">Colecci√≥n / Juguetes</option>
              </select>
              <p class="hint">Eleg√≠ una categor√≠a para mostrar solo esos productos.</p>
            </div>
          </div>

          <div class="hr"></div>
          <div id="prodGrid" class="gallery"></div>
        </div>

        <!-- SOBRE -->
        <div class="section" id="sobre">
          <div class="title">
            <div>
              <h2>Sobre Maxi</h2>
              <p>V√≠ctor Mauro Maximiliano Cortez (Maxi Cortez) ‚Äî fundador de Academia MC y del cortometraje Lapicini.</p>
            </div>
            <span class="badge">30/12/1994</span>
          </div>

          <div class="grid">
            <div class="card">
              <h3 style="margin:0 0 8px">Historia</h3>
              <p class="small" style="margin-top:0">
                Maxi comenz√≥ humildemente el camino del arte: caminaba mucho para ir casa a casa ofreciendo clases de dibujo y retratos.
                Hoy, con 17 a√±os de experiencia en dibujo realista y 9 a√±os como profesor, impulsa una comunidad art√≠stica para ni√±os,
                adolescentes y adultos, sin necesidad de conocimientos previos.
              </p>

              <div class="hr"></div>
              <h3 style="margin:0 0 8px">Redes</h3>
              <div class="row">
                <a class="btn ghost" href="https://www.instagram.com/maxicortez.dibujos?igsh=ZHh2YXVsdzdxa2sy" target="_blank" rel="noopener">Instagram personal</a>
                <a class="btn ghost" href="https://www.instagram.com/academiadearte_mc?igsh=b3J6dng0eW52MWJo" target="_blank" rel="noopener">Instagram Academia</a>
                <a class="btn ghost" href="https://www.facebook.com/share/16iud3rkDi/?mibextid=wwXIfr" target="_blank" rel="noopener">Facebook personal</a>
                <a class="btn ghost" href="https://www.facebook.com/share/1QG694BKdA/?mibextid=wwXIfr" target="_blank" rel="noopener">Facebook Academia</a>
                <a class="btn ghost" href="https://www.tiktok.com/@maxicortez.dibujos?_r=1&_t=ZM-923pKKQAlCN" target="_blank" rel="noopener">TikTok</a>
                <a class="btn ghost" href="https://youtube.com/@maxicortez.dibujos?si=YU2s9zo3TdHjlh1T" target="_blank" rel="noopener">YouTube</a>
              </div>
            </div>

            <div class="card">
              <h3 style="margin:0 0 8px">Contacto</h3>
              <p class="small">üì© Email: <a href="mailto:maurocortez17@gmail.com" style="color:var(--accent)">maurocortez17@gmail.com</a></p>
              <p class="small">üì≤ WhatsApp: <span style="color:var(--accent)">+54 358 4361289</span></p>
              <a class="btn primary" id="btnWhatsappSobre" href="#" target="_blank" rel="noopener">Hablar por WhatsApp</a>
            </div>
          </div>
        </div>

        <!-- ADMIN -->
        <div class="section" id="admin">
          <div class="title">
            <div>
              <h2>Panel Admin MC</h2>
              <p>Solo profesor. Activ√° ‚ÄúPago Lapicini‚Äù para desbloquear Cap√≠tulo 1 (local por ahora).</p>
            </div>
            <span class="badge">Admin: maurocortez17@gmail.com</span>
          </div>

          <div class="card">
            <h3 style="margin:0 0 8px">Usuarios registrados (este dispositivo)</h3>
            <div class="row" style="margin-bottom:10px">
              <button class="btn ghost" id="btnRefrescarAdmin" type="button">Refrescar</button>
              <button class="btn danger" id="btnLimpiarUsers" type="button">Borrar todos (este dispositivo)</button>
            </div>

            <div style="overflow:auto">
              <table>
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Pago Lapicini</th>
                    <th>Acci√≥n</th>
                  </tr>
                </thead>
                <tbody id="adminBody"></tbody>
              </table>
            </div>

            <p class="hint">Cuando pasemos a Firebase: esto ser√° global (compu + celu y todos los alumnos).</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      ¬© <span id="year"></span> Academia de Arte MC ‚Äî Maxi Cortez ‚Ä¢ Hecho con amor y visi√≥n üíö
    </footer>
  </div>

  <script>
    // ======= CONFIG =======
    const WHATSAPP = "5493584361289";
    const ADMIN_EMAIL = "maurocortez17@gmail.com";

    const horariosPorZona = {
      "R√≠o Cuarto": [
        "Ma√±ana: 08:30 a 10:00",
        "Ma√±ana: 10:00 a 11:30",
        "Tarde: 16:00 a 17:30",
        "Tarde: 17:30 a 19:00",
        "Tarde: 19:00 a 20:30"
      ],
      "Las Vertientes": [
        "Lunes (Ni√±os): 14:00 a 15:30",
        "Lunes (Adultos): 15:30 a 17:30",
        "Lunes (Ni√±os): 17:30 a 19:00"
      ],
      "Alcira Gigena": [
        "Viernes (Ni√±os): 15:00 a 16:30",
        "Viernes (Adultos): 16:30 a 18:30",
        "Viernes (Ni√±os): 18:30 a 20:00"
      ]
    };

    // ======= HELPERS =======
    const $ = (id)=>document.getElementById(id);
    function waLink(text){ return `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(text)}`; }
    function toast(msg){ alert(msg); }
    function readLS(key, fallback){
      try{ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
      catch(e){ return fallback; }
    }
    function saveLS(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

    function fileToDataURL(file){
      return new Promise((resolve, reject)=>{
        const fr = new FileReader();
        fr.onload = ()=> resolve(fr.result);
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    // ======= OJITO CONTRASE√ëA =======
    document.querySelectorAll(".eye").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-eye");
        const input = $(id);
        if(!input) return;
        input.type = (input.type === "password") ? "text" : "password";
      });
    });

    // ======= AUTH (LOCAL) =======
    // users: [{id,nombre,email,pass, paidLapicini:boolean}]
    function getUsers(){ return readLS("mc_users", []); }
    function setUsers(arr){ saveLS("mc_users", arr); }

    // session: {email}
    function getSession(){ return readLS("mc_session", null); }
    function setSession(s){ saveLS("mc_session", s); }
    function clearSession(){ localStorage.removeItem("mc_session"); }

    function getCurrentUser(){
      const sess = getSession();
      if(!sess?.email) return null;
      return getUsers().find(u => u.email === sess.email) || null;
    }
    function isAdmin(){
      const u = getCurrentUser();
      return !!u && u.email === ADMIN_EMAIL;
    }

    // ======= GATE UI =======
    const gate = $("gate");
    const loginBox = $("loginBox");
    const registerBox = $("registerBox");

    function showGate(){ gate.classList.add("show"); document.body.style.overflow = "hidden"; }
    function hideGate(){ gate.classList.remove("show"); document.body.style.overflow = ""; }

    $("btnSwitchGate").addEventListener("click", ()=>{
      loginBox.style.display = "none";
      registerBox.style.display = "block";
    });
    $("btnBackLogin").addEventListener("click", ()=>{
      registerBox.style.display = "none";
      loginBox.style.display = "block";
    });

    $("btnResetLocal").addEventListener("click", ()=>{
      clearSession();
      toast("Sesi√≥n borrada.");
      location.reload();
    });

    $("btnRegister").addEventListener("click", ()=>{
      const nombre = $("regNombre").value.trim();
      const email = $("regEmail").value.trim().toLowerCase();
      const pass  = $("regPass").value;

      if(!nombre || !email || !pass){
        toast("Complet√° nombre, email y contrase√±a.");
        return;
      }
      const users = getUsers();
      if(users.some(u=>u.email===email)){
        toast("Ese email ya existe. Prob√° iniciar sesi√≥n.");
        return;
      }
      users.push({
        id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),
        nombre, email, pass,
        paidLapicini: (email === ADMIN_EMAIL)
      });
      setUsers(users);
      setSession({ email });
      toast("‚úÖ Cuenta creada. Entrando...");
      location.reload();
    });

    $("btnLogin").addEventListener("click", ()=>{
      const email = $("loginEmail").value.trim().toLowerCase();
      const pass  = $("loginPass").value;

      const user = getUsers().find(u=>u.email===email && u.pass===pass);
      if(!user){
        toast("Email o contrase√±a incorrectos.");
        return;
      }
      setSession({ email });
      toast("‚úÖ Bienvenido/a.");
      location.reload();
    });

    // ======= TABS =======
    const tabButtons = document.querySelectorAll(".tab-btn");
    const sections = document.querySelectorAll(".section");
    tabButtons.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        tabButtons.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const id = btn.dataset.tab;
        sections.forEach(s=>s.classList.toggle("active", s.id === id));
      });
    });

    // ======= INSCRIPCION =======
    const zonaSel = $("inZona");
    const horarioSel = $("inHorario");

    function cargarHorarios(){
      const zona = zonaSel.value;
      horarioSel.innerHTML = `<option value="">Seleccionar</option>`;
      if(!zona || !horariosPorZona[zona]) return;
      horariosPorZona[zona].forEach(h=>{
        const opt = document.createElement("option");
        opt.value = h;
        opt.textContent = h;
        horarioSel.appendChild(opt);
      });
    }
    zonaSel.addEventListener("change", cargarHorarios);
    cargarHorarios();

    function getInscripciones(){ return readLS("mc_inscripciones", {}); } // {email:{...}}
    function setInscripciones(obj){ saveLS("mc_inscripciones", obj); }

    $("btnGuardarInscripcion").addEventListener("click", ()=>{
      const u = getCurrentUser();
      if(!u){ toast("Primero ingres√°."); return; }

      const nombre = $("inNombre").value.trim();
      const email = $("inEmail").value.trim().toLowerCase();
      const zona = zonaSel.value;
      const horario = horarioSel.value;

      if(!nombre || !email || !zona || !horario){
        toast("Complet√° nombre, email, zona y horario.");
        return;
      }

      const all = getInscripciones();
      all[u.email] = { nombre, email, zona, horario, updatedAt: new Date().toISOString() };
      setInscripciones(all);
      toast("‚úÖ Guardado. Ahora pod√©s enviar WhatsApp.");
      updateWhatsappButtons();
    });

    function buildWhatsappText(){
      const u = getCurrentUser();
      const all = getInscripciones();
      const data = (u && all[u.email]) ? all[u.email] : null;

      const nombre = data?.nombre || $("inNombre").value.trim() || "-";
      const email = data?.email || $("inEmail").value.trim() || (u?.email || "-");
      const zona = data?.zona || zonaSel.value || "-";
      const horario = data?.horario || horarioSel.value || "-";

      return `Hola Maxi! Quiero inscribirme en Academia de Arte MC.
Nombre: ${nombre}
Email: ${email}
Sede: ${zona}
Horario: ${horario}
Quiero confirmar inscripci√≥n y pago.`;
    }

    function updateWhatsappButtons(){
      $("btnWhatsapp").href = waLink(buildWhatsappText());
      $("btnWhatsappHeader").href = waLink("Hola Maxi! Quiero informaci√≥n de inscripci√≥n en Academia de Arte MC.");
      $("btnWhatsappSobre").href = waLink("Hola Maxi! Quiero informaci√≥n para inscribirme en Academia de Arte MC.");
    }

    ["input","change"].forEach(ev=>{
      ["inNombre","inEmail","inZona","inHorario"].forEach(id=>{
        $(id).addEventListener(ev, updateWhatsappButtons);
      });
    });

    // ======= GALERIA (LOCAL) =======
    function getObras(){ return readLS("mc_obras", []); }
    function setObras(arr){ saveLS("mc_obras", arr); }

    $("btnAgregarObra").addEventListener("click", async ()=>{
      const u = getCurrentUser();
      if(!u){ toast("Primero ingres√°."); return; }

      const zona = $("galZona").value;
      const autor = $("galAutor").value.trim();
      const file = $("galFile").files?.[0];
      if(!file){ toast("Eleg√≠ una imagen para subir."); return; }

      const dataUrl = await fileToDataURL(file);
      const obras = getObras();
      obras.push({
        id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),
        zona,
        autor: autor || u.nombre,
        img: dataUrl,
        createdAt: new Date().toISOString()
      });
      setObras(obras);
      $("galFile").value = "";
      $("galAutor").value = "";
      renderGaleria();
      toast("‚úÖ Obra agregada a la galer√≠a (local).");
    });

    $("btnLimpiarGaleria").addEventListener("click", ()=>{
      if(confirm("¬øBorrar toda la galer√≠a guardada en este dispositivo?")){
        localStorage.removeItem("mc_obras");
        renderGaleria();
      }
    });

    function renderGaleria(){
      const obras = getObras();
      const grid = $("galeriaGrid");
      grid.innerHTML = "";

      const cRC = obras.filter(o=>o.zona==="R√≠o Cuarto").length;
      const cLV = obras.filter(o=>o.zona==="Las Vertientes").length;
      const cAG = obras.filter(o=>o.zona==="Alcira Gigena").length;
      $("countRC").textContent = `R√≠o Cuarto: ${cRC}`;
      $("countLV").textContent = `Las Vertientes: ${cLV}`;
      $("countAG").textContent = `Alcira Gigena: ${cAG}`;

      if(obras.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">Todav√≠a no hay obras cargadas en este dispositivo.</div>`;
        return;
      }

      obras.slice().reverse().forEach(o=>{
        const el = document.createElement("div");
        el.className = "thumb";
        el.innerHTML = `
          <div class="tag">${o.zona}</div>
          <img src="${o.img}" alt="Obra">
          <div class="cap">Autor: ${o.autor || "Alumno/a"}<br><span class="small">${new Date(o.createdAt).toLocaleString()}</span></div>
        `;
        grid.appendChild(el);
      });
    }

    // ======= DESTACADOS (LOCAL) =======
    function getDest(){ return readLS("mc_destacados", []); }
    function setDest(arr){ saveLS("mc_destacados", arr); }

    $("btnAgregarDest").addEventListener("click", async ()=>{
      const u = getCurrentUser();
      if(!u){ toast("Primero ingres√°."); return; }

      const zona = $("desZona").value;
      const nombre = $("desNombre").value.trim();
      const anio = $("desAnio").value.trim() || "2025";
      const file = $("desFile").files?.[0];

      if(!nombre || !file){
        toast("Pon√© el nombre del alumno y eleg√≠ una imagen.");
        return;
      }

      const img = await fileToDataURL(file);
      const arr = getDest();
      arr.push({
        id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),
        zona, nombre, anio,
        img,
        createdAt: new Date().toISOString()
      });
      setDest(arr);

      $("desNombre").value = "";
      $("desFile").value = "";
      renderDestacados();
      toast("‚≠ê Destacado agregado.");
    });

    $("btnLimpiarDest").addEventListener("click", ()=>{
      if(confirm("¬øBorrar todos los destacados en este dispositivo?")){
        localStorage.removeItem("mc_destacados");
        renderDestacados();
      }
    });

    function renderDestacados(){
      const arr = getDest();
      const grid = $("destGrid");
      grid.innerHTML = "";

      const cRC = arr.filter(d=>d.zona==="R√≠o Cuarto").length;
      const cLV = arr.filter(d=>d.zona==="Las Vertientes").length;
      const cAG = arr.filter(d=>d.zona==="Alcira Gigena").length;
      $("countDRC").textContent = `R√≠o Cuarto: ${cRC}`;
      $("countDLV").textContent = `Las Vertientes: ${cLV}`;
      $("countDAG").textContent = `Alcira Gigena: ${cAG}`;

      if(arr.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">Todav√≠a no agregaste alumnos destacados en este dispositivo.</div>`;
        return;
      }

      arr.slice().reverse().forEach(d=>{
        const el = document.createElement("div");
        el.className = "thumb";
        el.innerHTML = `
          <div class="tag">${d.zona} ‚Ä¢ ${d.anio}</div>
          <img src="${d.img}" alt="Destacado">
          <div class="cap"><b>${d.nombre}</b><br><span class="small">Alumno destacado</span></div>
        `;
        grid.appendChild(el);
      });
    }

    // ======= LAPICINI PAYWALL =======
    function updateLapiciniAccessUI(){
      const u = getCurrentUser();
      const paid = !!u?.paidLapicini;
      $("badgeAcceso").textContent = paid ? "Acceso: HABILITADO ‚úÖ" : "Acceso: BLOQUEADO üîí";
      $("cap1Locked").style.display = paid ? "none" : "block";
      $("cap1Open").style.display = paid ? "block" : "none";

      const msg = `Hola Maxi! Quiero desbloquear el Cap√≠tulo 1 de Lapicini.
Mi email de registro es: ${u?.email || "-"}
Quiero el link de pago y habilitaci√≥n.`;
      $("btnWAUnlock").href = waLink(msg);
    }

    // ======= TIENDA LAPICINI (LOCAL) =======
    function getProducts(){ return readLS("mc_products", []); }
    function setProducts(arr){ saveLS("mc_products", arr); }

    $("btnAddProd").addEventListener("click", async ()=>{
      const u = getCurrentUser();
      if(!u){ toast("Primero ingres√°."); return; }

      const cat = $("prodCat").value;
      const name = $("prodName").value.trim();
      const desc = $("prodDesc").value.trim();
      const file = $("prodFile").files?.[0];

      if(!name || !file){
        toast("Pon√© nombre del producto y eleg√≠ una foto.");
        return;
      }

      const img = await fileToDataURL(file);
      const arr = getProducts();
      arr.push({
        id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),
        cat, name, desc, img,
        createdAt: new Date().toISOString()
      });
      setProducts(arr);

      $("prodName").value = "";
      $("prodDesc").value = "";
      $("prodFile").value = "";
      renderProducts();
      toast("üõçÔ∏è Producto agregado.");
    });

    $("btnClearProd").addEventListener("click", ()=>{
      if(confirm("¬øBorrar todos los productos cargados en este dispositivo?")){
        localStorage.removeItem("mc_products");
        renderProducts();
      }
    });

    $("prodFilter").addEventListener("change", renderProducts);

    function renderProducts(){
      const grid = $("prodGrid");
      grid.innerHTML = "";

      const filter = $("prodFilter").value;
      const arrAll = getProducts();
      const arr = (filter === "TODOS") ? arrAll : arrAll.filter(p=>p.cat === filter);

      if(arr.length === 0){
        grid.innerHTML = `<div class="card" style="grid-column:1/-1">No hay productos para mostrar en esta categor√≠a (en este dispositivo).</div>`;
        return;
      }

      arr.slice().reverse().forEach(p=>{
        const el = document.createElement("div");
        el.className = "thumb";
        const waMsg = `Hola Maxi! Quiero comprar un producto de Lapicini.
Producto: ${p.name}
Categor√≠a: ${p.cat}
Detalle: ${p.desc || "-"}
Mi email: ${getCurrentUser()?.email || "-"}`;
        el.innerHTML = `
          <div class="tag">${p.cat}</div>
          <img src="${p.img}" alt="Producto">
          <div class="cap">
            <b>${p.name}</b><br>
            <span class="small">${p.desc || ""}</span><br><br>
            <a class="btn primary" style="width:100%" href="${waLink(waMsg)}" target="_blank" rel="noopener">Comprar por WhatsApp</a>
          </div>
        `;
        grid.appendChild(el);
      });
    }

    // ======= ADMIN PANEL =======
    const adminBody = $("adminBody");

    function refreshAdmin(){
      adminBody.innerHTML = "";
      if(!isAdmin()){
        adminBody.innerHTML = `<tr><td colspan="4" class="small">Acceso denegado. Solo profesor.</td></tr>`;
        return;
      }

      const users = getUsers();
      if(users.length === 0){
        adminBody.innerHTML = `<tr><td colspan="4" class="small">No hay usuarios en este dispositivo.</td></tr>`;
        return;
      }

      users.slice().reverse().forEach(u=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.nombre}</td>
          <td>${u.email}</td>
          <td><span class="badge">${u.paidLapicini ? "S√≠ ‚úÖ" : "No üîí"}</span></td>
          <td class="row" style="gap:8px">
            <button class="btn ghost" data-toggle="${u.email}" type="button">Toggle Pago</button>
            <button class="btn danger" data-del="${u.email}" type="button">Eliminar</button>
          </td>
        `;
        adminBody.appendChild(tr);
      });

      adminBody.querySelectorAll("button[data-toggle]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const email = btn.getAttribute("data-toggle");
          const users = getUsers();
          const idx = users.findIndex(x=>x.email===email);
          if(idx>=0){
            users[idx].paidLapicini = !users[idx].paidLapicini;
            setUsers(users);
            refreshAdmin();
            updateLapiciniAccessUI();
          }
        });
      });

      adminBody.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const email = btn.getAttribute("data-del");
          if(!confirm("¬øEliminar usuario?")) return;
          const users = getUsers().filter(x=>x.email!==email);
          setUsers(users);
          const sess = getSession();
          if(sess?.email === email){ clearSession(); }
          refreshAdmin();
          updateLapiciniAccessUI();
        });
      });
    }

    $("btnRefrescarAdmin").addEventListener("click", refreshAdmin);
    $("btnLimpiarUsers").addEventListener("click", ()=>{
      if(!isAdmin()){ toast("Solo profesor."); return; }
      if(confirm("¬øBorrar TODOS los usuarios de este dispositivo?")){
        localStorage.removeItem("mc_users");
        localStorage.removeItem("mc_session");
        refreshAdmin();
        toast("Listo. Se borr√≥ el registro local.");
        location.reload();
      }
    });

    function enforceAdminVisibility(){
      const adminTab = $("tabAdmin");
      adminTab.style.display = isAdmin() ? "flex" : "none";
    }

    // ======= LOGOUT =======
    $("btnLogout").addEventListener("click", ()=>{
      clearSession();
      toast("Sesi√≥n cerrada.");
      location.reload();
    });

    // ======= INIT =======
    $("year").textContent = new Date().getFullYear();

    const current = getCurrentUser();
    if(!current){
      showGate();
    }else{
      hideGate();
      $("userLine").textContent = `Sesi√≥n: ${current.nombre} ‚Ä¢ ${current.email}`;
      $("inNombre").value = current.nombre || "";
      $("inEmail").value = current.email || "";
    }

    updateWhatsappButtons();
    renderGaleria();
    renderDestacados();
    renderProducts();
    enforceAdminVisibility();
    refreshAdmin();
    updateLapiciniAccessUI();
  </script>
</body>
</html>
